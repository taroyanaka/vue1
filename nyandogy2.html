<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç®¡ç†</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.37/dist/vue.global.js"></script>
    <style>
        .creature { margin: 0px; padding: 0px; border: 1px solid #ccc; }
        .message-container {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            text-align: center;
            padding: 10px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="message-container">
            <div v-for="creature in creatures" :key="creature.id">{{ creature.message }}</div>
        </div>
        <h3>ğŸ’°: {{ mny }} mny  ğŸª¦: {{ deathCount }} â±ï¸: {{ totalInterval }}</h3>
        
        <div v-for="creature in creatures" :key="creature.id" class="creature">
            ğŸ´<span @click="feed(creature)">{{ creature.fu }} / {{ creature.ev[creature.type]?.fu || 100 }}
                <progress :value="creature.fu" max="100">{{ creature.fu }}%</progress>
            </span>
            ğŸ›<span @click="play(creature)">{{ creature.ha }} / {{ creature.ev[creature.type]?.ha || 100 }}
                <progress :value="creature.ha" max="100">{{ creature.ha }}%</progress>
            </span>
            ğŸ’©<span @click="toilet(creature)">{{ creature.poop }} / {{ creature.maxPoop }}
                <progress :value="creature.poop" :max="creature.maxPoop">{{ creature.poop }}/{{ creature.maxPoop }}</progress>
            </span>
            <span v-if="creature.type < creature.ev.length">ğŸ’©{{ creature.ev[creature.type].poop }}</span>

            â±ï¸<progress :value="creature.pb" max="100">{{ creature.rem }}</progress>
            {{ creature.emoji }} {{ creature.name }}: ğŸ’°{{ creature.gld }} gld
            <!-- å£²å´ -->
            <button @click="sellCreature(creature)">å£²å´</button>
        </div>

        <h2>ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼è³¼å…¥</h2>
        <div v-for="template in creatureTemplates" :key="template.id" class="creature">
            <h4>{{ template.emoji }} {{ template.name }}: ğŸ’°{{ template.gld }} gld</h4>
            <button @click="buyCreature(template)">è³¼å…¥ ({{ discountPrice(template.price) }} mny)</button>
        </div>

        <h2>é€²åŒ–æ¡ä»¶ä¸€è¦§</h2>
        <div v-for="template in creatureTemplates" :key="template.id" class="creature">
            <h4>{{ template.emoji }} {{ template.name }}: ğŸ’°{{ template.gld }} gld</h4>
            <ul>
                <li v-for="ev in template.ev" :key="ev.newName">
                    {{ ev.newName }}: ğŸ´{{ ev.fu }} ğŸ›{{ ev.ha }} ğŸ’©{{ ev.poop }}
                </li>
            </ul>
        </div>

        <h2>è¨­å®š</h2>
        <div>
            <label>æº€è…¹åº¦æ¸›å°‘é–“éš”: <input type="number" v-model.number="settings.fd" min="1"></label>
            <label>å¹¸ã›åº¦æ¸›å°‘é–“éš”: <input type="number" v-model.number="settings.hd" min="1"></label>
            <label>é€²åŒ–é–“éš”: <input type="number" v-model.number="settings.tm" min="1"></label>
        </div>

    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    totalInterval: 0,
                    deathCount: 0,
                    creatures: [],
                    creatureTemplates: [
                        { id: 1, name: 'ãƒã‚ºãƒŸãƒ¼', emoji: 'ğŸ­', fu: 50, ha: 50, alive: true, poop: 0, type: 0, maxPoop: 30, gld: 5, price: 100, ev: [
                            { fu: 17.5, ha: 17.5, poop: 4, newName: 'ãƒã‚ºãƒŸç‹', newEmoji: 'ğŸ­ğŸ‘‘', newGld: 10, maxPoop: 28 },
                            { fu: 35, ha: 35, poop: 8, newName: 'ãƒã‚ºãƒŸå¤§ç‹', newEmoji: 'ğŸ­ğŸ‘‘ğŸ‘‘', newGld: 20, maxPoop: 26 },
                            { fu: 52.5, ha: 52.5, poop: 12, newName: 'ãƒã‚ºãƒŸçš‡å¸', newEmoji: 'ğŸ­ğŸ‘‘ğŸ‘‘ğŸ‘‘', newGld: 30, maxPoop: 24 },
                            { fu: 70, ha: 70, poop: 16, newName: 'ãƒã‚ºãƒŸç¥', newEmoji: 'ğŸ­ğŸ˜‡', newGld: 40, maxPoop: 22 }
                        ], rem: 10, pb: 100, message: '' },
                        { id: 2, name: 'ãƒã‚³ãƒ¼', emoji: 'ğŸ±', fu: 50, ha: 50, alive: true, poop: 0, type: 0, maxPoop: 45, gld: 7, price: 1000, ev: [
                            { fu: 20, ha: 20, poop: 6, newName: 'ãƒã‚³ç‹', newEmoji: 'ğŸ±ğŸ‘‘', newGld: 14, maxPoop: 42 },
                            { fu: 40, ha: 40, poop: 12, newName: 'ãƒã‚³å¤§ç‹', newEmoji: 'ğŸ±ğŸ‘‘ğŸ‘‘', newGld: 28, maxPoop: 39 },
                            { fu: 60, ha: 60, poop: 18, newName: 'ãƒã‚³çš‡å¸', newEmoji: 'ğŸ±ğŸ‘‘ğŸ‘‘ğŸ‘‘', newGld: 42, maxPoop: 36 },
                            { fu: 80, ha: 80, poop: 24, newName: 'ãƒã‚³ç¥', newEmoji: 'ğŸ±ğŸ˜‡', newGld: 56, maxPoop: 33 }
                        ], rem: 10, pb: 100, message: '' },
                        { id: 3, name: 'ã‚¤ãƒŒãƒ¼', emoji: 'ğŸ¶', fu: 50, ha: 50, alive: true, poop: 0, type: 0, maxPoop: 60, gld: 9, price: 10000, ev: [
                            { fu: 22.5, ha: 22.5, poop: 8, newName: 'ã‚¤ãƒŒç‹', newEmoji: 'ğŸ¶ğŸ‘‘', newGld: 18, maxPoop: 56 },
                            { fu: 45, ha: 45, poop: 16, newName: 'ã‚¤ãƒŒå¤§ç‹', newEmoji: 'ğŸ¶ğŸ‘‘ğŸ‘‘', newGld: 36, maxPoop: 52 },
                            { fu: 67.5, ha: 67.5, poop: 24, newName: 'ã‚¤ãƒŒçš‡å¸', newEmoji: 'ğŸ¶ğŸ‘‘ğŸ‘‘ğŸ‘‘', newGld: 54, maxPoop: 48 },
                            { fu: 85, ha: 85, poop: 32, newName: 'ã‚¤ãƒŒç¥', newEmoji: 'ğŸ¶ğŸ˜‡', newGld: 72, maxPoop: 44 }
                        ], rem: 10, pb: 100, message: '' },
                        { id: 4, name: 'æœªçŸ¥ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼', emoji: 'ğŸ¦„', fu: 50, ha: 50, alive: true, poop: 0, type: 0, maxPoop: 90, gld: 12, price: 100000, ev: [
                            { fu: 25, ha: 25, poop: 12, newName: 'ç‹', newEmoji: 'ğŸ’', newGld: 24, maxPoop: 85 },
                            { fu: 50, ha: 50, poop: 24, newName: 'å¤§ç‹', newEmoji: 'ğŸš¶', newGld: 48, maxPoop: 80 },
                            { fu: 75, ha: 75, poop: 36, newName: 'çš‡å¸', newEmoji: 'ğŸ•º', newGld: 72, maxPoop: 75 },
                            { fu: 90, ha: 90, poop: 48, newName: 'ç¥', newEmoji: 'ğŸ˜‡', newGld: 96, maxPoop: 70 }
                        ], rem: 10, pb: 100, message: '' },
                    ],
                    settings: { fd: 1, hd: 1, tm: 1 },

                    timer: null,
                    mny: 500 // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒãƒãƒ¼
                };
            },
            computed: {
                totalPoopCount() {
                    return this.creatures ? this.creatures.reduce((total, c) => total + c.poop, 0) : 0;
                }
            },
            methods: {
                feed(c) { if (!c.alive) return; c.fu = Math.min(c.fu + 10, 100); this.checkAlive(c); },
                play(c) { if (!c.alive) return; c.ha = Math.min(c.ha + 10, 100); this.checkAlive(c); },
                toilet(c) { if (!c.alive) return; c.poop = 0; this.checkAlive(c); }, // ğŸ’©ã‚’0ã«ãƒªã‚»ãƒƒãƒˆ
                evolve(c) {
                    // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ãŒç„¡ã„å ´åˆã¯é€²åŒ–ã›ãšã«çµ‚äº†
                    if (c.type >= c.ev.length) {
                        return;
                    }

                    const evolutionStage = c.ev[c.type];
                    if (evolutionStage && c.fu >= evolutionStage.fu && c.ha >= evolutionStage.ha && c.poop <= evolutionStage.poop) {
                        c.message = `${c.name}ãŒé€²åŒ–ã—ãŸï¼`;
                        c.name = evolutionStage.newName;
                        c.emoji = evolutionStage.newEmoji;
                        c.gld = evolutionStage.newGld; // é€²åŒ–å¾Œã®gldã‚’è¨­å®š
                        c.maxPoop = evolutionStage.maxPoop; // é€²åŒ–å¾Œã®maxPoopã‚’è¨­å®š
                        c.type += 1; // é€²åŒ–ã‚¿ã‚¤ãƒ—ã‚’å¢—ã‚„ã™
                    } else {
                        c.message = `${c.name}ã¯é€²åŒ–ã§ãã¾ã›ã‚“ã€‚æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚`;
                    }
                },
                checkAlive(c) {
                    if (c.fu <= 0 || c.ha <= 0 || c.poop >= c.maxPoop) {
                        c.alive = false;
                        c.message = `${c.name}ã¯äº¡ããªã‚Šã¾ã—ãŸã€‚`;
                        this.deathCount += 1;
                        this.creatures = this.creatures.filter(creature => creature.id !== c.id); // ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’ä¸€è¦§ã‹ã‚‰å‰Šé™¤
                    } else {
                        c.message = '';
                    }
                },
                buyCreature(template) {
                    if (this.mny >= template.price) {
                        this.mny -= this.discountPrice(template.price); // è³¼å…¥ä¾¡æ ¼ã‚’æ”¯æ‰•ã†
                        const newCreature = { ...template, id: Date.now() }; // æ–°ã—ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’ä½œæˆ
                        this.creatures.push(newCreature);
                    } else {
                        // alert('ãƒãƒãƒ¼ãŒè¶³ã‚Šã¾ã›ã‚“');
                    }
                },
                // é£¼è‚²ä¸­ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®æ•°*1%ã®è³¼å…¥ä¾¡æ ¼ã®å‰²å¼•ã®æ©Ÿèƒ½ã‚’å°å…¥ã—ã¦
                discountPrice(price) {
                    const discount = Math.floor(this.creatures.length * 0.01 * price);
                    return price - discount;
                },
                sellCreature(creature) {
                    const sellPrice = creature.price / 2; // å£²å´ä¾¡æ ¼ã¯è³¼å…¥ä¾¡æ ¼ã®åŠåˆ†
                    this.mny += sellPrice;
                    this.creatures = this.creatures.filter(c => c.id !== creature.id); // ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’ä¸€è¦§ã‹ã‚‰å‰Šé™¤
                },
                startTimer() {
                    this.timer = setInterval(() => {
                        this.creatures.forEach(c => {
                            if (c.alive) {
                                // æ™‚é–“çµŒéã§æº€è…¹åº¦ã¨å¹¸ã›åº¦ã‚’æ¸›å°‘
                                c.fu = Math.max(c.fu - this.settings.fd, 0);
                                c.ha = Math.max(c.ha - this.settings.hd, 0);
                                c.rem -= this.settings.tm;

                                // ğŸ’©ã‚’å¢—åŠ 
                                c.poop += 1; // 1ç§’ã”ã¨ã«ğŸ’©ã‚’1ã¤å¢—ã‚„ã™
                                this.checkAlive(c); // ç”Ÿå­˜ãƒã‚§ãƒƒã‚¯

                                if (c.rem <= 0) {
                                    this.evolve(c); // é€²åŒ–ãƒã‚§ãƒƒã‚¯
                                    c.rem = 10; // æ®‹ã‚Šæ™‚é–“ã‚’ãƒªã‚»ãƒƒãƒˆ
                                }
                                c.pb = (c.rem / 10) * 100;

                                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒãƒãƒ¼ã‚’å¢—åŠ 
                                this.mny += c.gld;
                            }
                            this.totalInterval += 1;
                        });
                    }, 1000);
                },
                stopTimer() { clearInterval(this.timer); this.timer = null; }
            },
            mounted() {
                this.startTimer(); // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
            },
            beforeUnmount() {
                this.stopTimer(); // ã‚¢ãƒ—ãƒªçµ‚äº†æ™‚ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
            }
        }).mount('#app');
    </script>
</body>
</html>